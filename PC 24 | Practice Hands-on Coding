import 'dart:math';
import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:audioplayers/audioplayers.dart';

// Providers
final colorProvider = StateProvider<Color>((ref) => Colors.white);
final noteProvider = StateProvider<int>((ref) => 1);

void main() {
  runApp(const ProviderScope(child: MyApp()));
}

class MyApp extends ConsumerWidget {
  const MyApp({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final bgColor = ref.watch(colorProvider);

    return MaterialApp(
      debugShowCheckedModeBanner: false,
      home: Scaffold(
        backgroundColor: bgColor,
        appBar: AppBar(
          title: const Text("Riverpod Music Notes"),
          backgroundColor: bgColor,
          foregroundColor: Colors.black,
        ),
        body: const Center(child: ColorNoteButton()),
      ),
    );
  }
}

class ColorNoteButton extends ConsumerWidget {
  const ColorNoteButton({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    return ElevatedButton(
      onPressed: () async {
        // 1. Change background color
        final colors = [Colors.red, Colors.green, Colors.blue, Colors.orange, Colors.purple, Colors.teal, Colors.pink, Colors.amber, Colors.cyan, Colors.indigo];
        final newColor = colors[Random().nextInt(colors.length)];
        ref.read(colorProvider.notifier).state = newColor;

        // 2. Pick a random note between 1 and 10
        final noteNumber = Random().nextInt(10) + 1;
        ref.read(noteProvider.notifier).state = noteNumber;

        // 3. Play the note
        final player = AudioPlayer();
        await player.play(AssetSource('note$noteNumber.wav'));
      },
      child: const Text("Play Note & Change Color"),
    );
  }
}
